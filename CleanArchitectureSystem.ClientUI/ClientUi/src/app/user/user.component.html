<div class="container mt-4">
    <!-- Form Card -->
    <div class="card shadow-sm border-0">
        <div class="card-header bg-light fw-semibold">
            <i class="fa fa-plus-circle me-2"></i>User Registration
        </div>
        <div class="card-body">
            @if (showValidationAlert && userForm.invalid) {
            <div class="alert alert-danger py-2 px-3 small mb-3">
                <i class="fa fa-exclamation-circle me-2"></i>
                Check the data in the required fields (<span class="text-danger fw-bold">*</span>).
            </div>
            }

            <form [formGroup]="userForm" class="row g-3">
                <!-- Fields -->
                <div class="col-md-4">
                    <label class="form-label">*First Name</label>
                    <input id="firstName" formControlName="firstName" type="text" class="form-control text-capitalize"
                     [class.is-invalid]="userForm.get('firstName')?.touched && userForm.get('firstName')?.invalid"
                        placeholder="First Name" 
                        required (input)="updateUserName()" />
                </div>
                
                <div class="col-md-4">
                    <label class="form-label">*Last Name</label>
                    <input id="lastName" formControlName="lastName" type="text" class="form-control text-capitalize"
                     [class.is-invalid]="userForm.get('lastName')?.touched && userForm.get('lastName')?.invalid"
                        placeholder="Last Name" 
                        required (input)="updateUserName()" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">*Email</label>
                    <input id="email" formControlName="email" type="email" class="form-control" required 
                    [class.is-invalid]="userForm.get('email')?.touched && userForm.get('email')?.invalid"
                        placeholder="Email Address" >
                </div>

                <div class="col-md-6">
                    <label class="form-label">*Role</label>
                    <select id="role" formControlName="role" class="form-select" 
                    [class.is-invalid]="userForm.get('role')?.touched && userForm.get('role')?.invalid"
                        placeholder="User Role">
                        <option [value]="''" disabled>-- Select Role --</option>
                        <option [value]="'User'">User</option>
                        <option [value]="'Administrator'">Administrator</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="form-label">*Status</label>
                    <select id="isActive" formControlName="isActive" class="form-select"
                     [class.is-invalid]="userForm.get('isActive')?.touched && userForm.get('isActive')?.invalid"
                        placeholder="User Status">
                        <option [ngValue]=null disabled>-- Select Status --</option>
                        <option [ngValue]=true>Active</option>
                        <option [ngValue]=false>Inactive</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">*Username</label>
                    <input id="username" formControlName="username" type="text" class="form-control" required
                        readonly   
                        [class.is-invalid]="userForm.get('username')?.touched && userForm.get('username')?.invalid"
                        placeholder="Username"/>

                    <div class="mt-1">
                        <small class="fw-bold fst-italic text-secondary text-dark">
                            Password format:
                            <span class="text-dark">
                                Username + &#64; + current year 
                                <br> Example: JDelaCruz&#64;2025
                                <!-- &#64; is the HTML entity for @  -->
                            </span>
                        </small>
                    </div>
                </div>
                <div class="col-12 text-end mt-3">
                    @if (formMode !== FormMode.View) {
                    <button type="button" class="btn btn-primary btn-sm px-4" (click)="openConfirmation()"
                        [disabled]="isSaving"
                        [attr.title]="userForm.invalid ? 'Please complete all required fields.' : null">
                        @if (isSaving) {
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        Saving...
                        } @else {
                        <i class="fa fa-save me-2"></i>
                        {{ formMode === FormMode.Edit ? 'Update' : 'Save' }}
                        }
                    </button>
                    }

                    @if (formMode === FormMode.View || formMode === FormMode.Edit && !isSaving) {
                    <button type="button" class="btn btn-danger btn-sm ms-2" (click)="resetForm()">
                        <i class="fa fa-times-circle me-1"></i> Close
                    </button>
                    }
                </div>
            </form>
        </div>
    </div>

    <!-- Table Card -->
    <div class="card mt-4 shadow-sm border-0">
        <div class="card-header bg-light fw-semibold px-3 py-3">
            <div class="row align-items-center">
                <div class="col">
                    <i class="fa fa-table me-2"></i>Existing Records
                </div>
                <div class="col-auto">
                    <input type="text" class="form-control form-control-sm" style="width: 250px;" [value]="searchBox()"
                        (input)="searchBox.set($any($event.target).value)" placeholder="Search here" />
                </div>
            </div>
        </div>

        <div class="card-body px-3 py-4">
            <div class="table-responsive">
                <app-user-table [userList]="paginatedUserList()" (sort)="handleSort($event)"
                    (edit)="populateFormEdit($event)" (view)="populateFormView($event)" (reset)="resetUserPassword($event)"
                    ></app-user-table>
            </div>

        </div>
    </div>
</div>